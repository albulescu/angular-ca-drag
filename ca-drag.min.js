/**
* Drag & Drop AngularJS Module v1.1.4
* https://github.com/albulescu/caDrag
*
* Author Albulescu Cosmin <cosmin@albulescu.ro>
* Licensed under the MIT license.
*/

"use strict";angular.module("caDrag",[]).provider("DragManager",function(){var a={startDistance:20,showFeedback:!0,dragOffset:[0,0],dragPosition:"corner",indicatorScale:1,indicatorStyle:{},indicatorFactory:null};this.setDragOffset=function(b,c){a.dragOffset=[b||0,c||0]},this.setDragPosition=function(b){a.dragPosition=b||a.dragPosition,0===a.dragOffset[0]&&0===a.dragOffset[1]&&this.setDragOffset(20,20)},this.setIndicatorScale=function(b){a.indicatorScale=b||a.indicatorScale},this.setIndicatorStyle=function(b){a.indicatorStyle=b||a.indicatorStyle},this.setIndicatorFactory=function(b){a.indicatorFactory=b},this.setStartDistance=function(b){a.startDistance=b||a.startDistance},this.$get=["$document","$timeout","$log","DraggableElement","DragUtil",function(b,c,d,e,f){var g=angular.forEach,h=angular.isDefined,i=!1,j=[],k=[],l=null,m=!1,n=!1,o=function(){l=this,i=!0},p=function(){var a=n.data("ca-drop-hover")||angular.noop,b=l.event("drop.over",event.originalEvent);a(n.data("ca-drop-scope"),{$event:b}),n.addClass("ca-drag-over"),b.isDefaultPrevented()===!1&&l.setFeedback("accept")},q=function(a){var b,c=f.getEventPosition(a);if(g(k,function(a){var d=a[0].getBoundingClientRect();return d.left<c.x&&d.right>c.x&&d.top<c.y&&d.bottom>c.y?(b=a,!0):void 0}),b){var d=l.getType(),e=b.data("ca-drop-type")||!1;if(d!==e)return;n||(n=b,p(a))}else s()},r=function(a){i&&(n=t(a.currentTarget),n&&p(a))},s=function(){n&&(n.removeClass("ca-drag-over"),n=null),l&&l.setFeedback("reject")},t=function(a){a=angular.element(a);for(var b=0;b<k.length;b++){var c=k[b];if(a[0]===c[0]){var d=l.getType(),e=c.data("ca-drop-type")||!1;return(d||e)&&d!==e?null:c}}return null},u=function(a){if(c(function(){i=!1}),!n)return void(l=null);var b=n.attr("ca-drop-model"),d=n.data("ca-drop-scope"),e=n.data("ca-drop-complete")||angular.noop;if(e(d,{$event:a}),!a.isDefaultPrevented()){var f=a.element.remove();n.append(f)}if(b){var g=d[b];h(g)&&(angular.isArray(g)?g.push(a.target.data):d[b]=a.target.data)}l=null};a.indicatorFactory||(a.indicatorFactory=function(a){if(!m)return null;var b;if(h(m[a]))b=angular.element(m[a]);else{if(!h(m["default"]))return null;b=angular.element(m["default"])}return b.css("pointer-events","none"),b});var v={cancel:function(){return l?(l.cancel(),!0):!1},addDropTarget:function(a,b,c,d){if(-1===k.indexOf(a)){var e=a.data("ca-drap-scope");if(e)return e;a.data("ca-drop-scope",b),angular.isFunction(c)&&a.data("ca-drop-hover",c),angular.isFunction(d)&&a.data("ca-drop-complete",d),f.isMobile()||(a.on("mouseover",r),a.on("mouseout",s)),k.push(a)}},registerIndicator:function(a,b){if(h(m[b||"default"]))throw new Error("This indicator already registered");m=m||{},m[b||"default"]=a},register:function(b){var c=b.data("ca-drag");return c?c:(c=new e(b),c.setOptions(a),c.setType(b.attr("ca-drag-type")),c.on("start",o),c.on("complete",u),f.isMobile()&&c.on("dragging",q),b.data("ca-drag",c),j.push(c),c)}};return Object.defineProperty(v,"dragging",{get:function(){return i}}),Object.defineProperty(v,"active",{get:function(){return l}}),v}]}),angular.module("caDrag").service("DraggableElement",["$rootScope","$timeout","$document","$compile","DragUtil",function(a,b,c,d,e){var f=function(){return!0},g=function(){return!1},h=function(a,b,c){this.type=a,this.target=b,this.element=b.element,this.originalEvent=c};h.prototype={constructor:h,isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=f,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=f,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=f,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}};var i=c.find("body"),j=function(b){function f(a,b){var c=getComputedStyle(b);if(u)a.style.cssText=c.cssText;else for(var d in c)isNaN(parseInt(d,10))&&"function"!=typeof c[d]&&!/^(cssText|length|parentRule)$/.test(d)&&(a.style[d]=c[d])}function g(a,b){var c=a.querySelectorAll("*"),d=b.querySelectorAll("*");f(a,b,1),Array.prototype.forEach.call(c,function(a,b){f(a,d[b])}),a.style.margin=a.style.marginLeft=a.style.marginTop=a.style.marginBottom=a.style.marginRight=""}var j,k,l,m,n,o,p,q,r=!1,s=null,t={},u=""!==getComputedStyle(document.body).cssText,v=function(){var b=t.indicatorFactory||angular.noop,c=b(s,l,j);if(c){var e=a.$new(!0);d(c)(e),e.$apply(function(){angular.forEach(j,function(a,b){e[b]=a})}),c.css("display","block")}else{c=angular.element("<div>");var f=l[0].cloneNode(!0);f.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),g(f,l[0]);var h=(new XMLSerializer).serializeToString(f),k='<svg xmlns="http://www.w3.org/2000/svg" width="'+p.width+'" height="'+p.height+'"><foreignObject width="100%" height="100%" >'+h+"</foreignObject></svg>";c.append(k)}var m=angular.extend({"pointer-events":"none",position:"absolute",zIndex:"10000"},t.indicatorStyle);c.css(m),c.addClass("ca-drag"),1!==t.indicatorScale&&c.css({"transform-origin":"0% 0%","-ms-transform":"scale("+t.indicatorScale+")","-webkit-transform":"scale("+t.indicatorScale+")",transform:"scale("+t.indicatorScale+")"}),t.showFeedback&&(n=angular.element('<div class="feedback reject"></div>'),c.append(n)),i.append(c),o=c},w=function(a){p=e.getRect(l[0]),q=a,v(),x(a)},x=function(a){var b=0,c=0,d=e.getEventPosition(a),f=e.getEventPosition(q),g=e.getRect(o[0]);switch(t.dragPosition){case"center":b=d.x+t.dragOffset[0]-g.width/2,c=d.y+t.dragOffset[1]-g.height/2;break;case"clone":b=p.left-f.x+d.x+t.dragOffset[0],c=p.top-f.y+d.y+t.dragOffset[1];break;default:case"corner":b=d.x+t.dragOffset[0],c=d.y+t.dragOffset[1]}o.css({left:b+"px",top:c+"px"})},y=function(a){l=a;var b=this,d=function(a){r=!1,o&&o.remove(),c.unbind("touchmove mousemove",f),c.unbind("touchend mouseup",d),b.emit("complete",new h("drag.complete",b,a))},f=function(a){if(r)return a.preventDefault(),x(a),void b.emit("dragging",new h("drag.move",b,a));var c=e.getEventsDistance(k,a);!r&&c>t.startDistance&&(r=!0,w(a),b.emit("start",new h("drag.start",b,a)))};a.bind("touchstart mousedown",function(a){a.preventDefault(),k=a,c.bind("touchmove mousemove",f),c.bind("touchend mouseup",d)}),Object.defineProperty(this,"dragging",{get:function(){return r}}),Object.defineProperty(this,"data",{get:function(){return j},set:function(a){j=a}}),Object.defineProperty(this,"element",{get:function(){return l}}),this.cancel=function(){d()}};return y.prototype={on:function(a,b){m=m||{},m[a]=m[a]||[],m[a].push(b)},off:function(a,b){m=m||{},a in m!=!1&&m[a].splice(m[a].indexOf(b),1)},emit:function(a){if(m=m||{},a in m!=!1)for(var b=0;b<m[a].length;b++)m[a][b].apply(this,Array.prototype.slice.call(arguments,1))},setOptions:function(a){t=a},setType:function(a){s=a},getType:function(){return s},event:function(a,b){return new h(a,this,b)},setFeedback:function(a){t.showFeedback&&n.attr("class","feedback "+a)}},new y(b)};return j}]),angular.module("caDrag").directive("caDragData",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){var e=a.register(c);d.caDragData&&(e.data=b.$eval(d.caDragData))}}}]).directive("caDragEnabled",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.register(c)}}}]).directive("caDropType",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){a.addDropTarget(c,b),c.data("ca-drop-type",d.caDropType)}}}]).directive("caDragIndicator",["DragManager",function(a){return{restrict:"A",compile:function(b,c){b[0].removeAttribute("ca-drag-indicator");var d=angular.element("<div>").append(b);a.registerIndicator(d.html(),c.caDragIndicator),b.remove()}}}]).directive("caDragBegin",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragBegin){var g=b(e.caDragBegin);angular.isFunction(g)&&f.on("start",function(a){g(c,{$event:a})})}}}}]).directive("caDragMove",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragMove){var g=b(e.caDragMove);angular.isFunction(g)&&f.on("dragging",function(a){g(c,{$event:a})})}}}}]).directive("caDragComplete",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragComplete){var g=b(e.caDragComplete);angular.isFunction(g)&&f.on("complete",function(a){g(c,{$event:a})})}}}}]).directive("caDropComplete",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropComplete&&(f=a(e.caDropComplete)),b.addDropTarget(d,c),d.data("ca-drop-complete",f)}}}]).directive("caDropHover",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropHover&&(f=a(e.caDropHover)),b.addDropTarget(d,c),d.data("ca-drop-hover",f)}}}]).directive("caDropAccept",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.addDropTarget(c,b)}}}]),angular.module("caDrag").service("DragUtil",function(){this.isMobile=function(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())},this.getRect=function(a){return a.getBoundingClientRect()},this.getEventsDistance=function(a,b){var c=this.getEventPosition(a),d=this.getEventPosition(b),e=0,f=0;return e=d.x-c.x,e*=e,f=d.y-c.y,f*=f,Math.sqrt(e+f)},this.getEventPosition=function(a){var b=0,c=0;if(a instanceof window.TouchEvent)a.touches&&a.touches.length&&(b=a.touches[0].pageX,c=a.touches[0].pageY);else{if(angular.isDefined(a.element)&&angular.isDefined(a.originalEvent))return this.getEventPosition(a.originalEvent);b=a.pageX,c=a.pageY}return{x:b,y:c}}});