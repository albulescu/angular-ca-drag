/**
* Drag & Drop AngularJS Module v1.1.1
* https://github.com/albulescu/caDrag
*
* Author Albulescu Cosmin <cosmin@albulescu.ro>
* Licensed under the MIT license.
*/

"use strict";angular.module("caDrag",[]).provider("DragManager",function(){var a={showFeedback:!0,dragOffset:[0,0],dragPosition:"corner",indicatorScale:1,indicatorStyle:[],indicatorFactory:null};this.setDragOffset=function(b,c){a.dragOffset=[b||0,c||0]},this.setDragPosition=function(b){a.dragPosition=b||"corner"},this.setIndicatorScale=function(b){a.indicatorScale=b||1},this.setIndicatorStyle=function(b){a.indicatorStyle=b||{}},this.setIndicatorFactory=function(b){a.indicatorFactory=b},this.$get=["$document","$timeout","$log","DraggableElement","DragUtil",function(b,c,d,e,f){var g=angular.forEach,h=!1,i=[],j=[],k=null,l=!1,m=!1,n=function(){k=this,h=!0},o=function(){var a=m.data("ca-drop-hover")||angular.noop,b=k.event("drop.over",event.originalEvent);a(m.data("ca-drop-scope"),{$event:b}),m.addClass("ca-drag-over"),b.isDefaultPrevented()===!1&&k.setFeedback("accept")},p=function(a){var b,c=f.getEventPosition(a);if(g(j,function(a){var d=a[0].getBoundingClientRect();return d.left<c.x&&d.right>c.x&&d.top<c.y&&d.bottom>c.y?(b=a,!0):void 0}),b){var d=k.getType(),e=b.data("ca-drop-type")||!1;if(d!==e)return;m||(m=b,o(a))}else r()},q=function(a){h&&(m=s(a.currentTarget),m&&o(a))},r=function(){m&&(m.removeClass("ca-drag-over"),m=null),k&&k.setFeedback("reject")},s=function(a){a=angular.element(a);for(var b=0;b<j.length;b++){var c=j[b];if(a[0]===c[0]){var d=k.getType(),e=c.data("ca-drop-type")||!1;return(d||e)&&d!==e?null:c}}return null},t=function(a){if(c(function(){h=!1}),!m)return void(k=null);var b=m.attr("ca-drop-model"),d=m.data("ca-drop-scope"),e=m.data("ca-drop-complete")||angular.noop;if(e(d,{$event:a}),!a.isDefaultPrevented()){var f=a.element.remove();m.append(f)}if(b){var g=d[b];angular.isDefined(g)&&(angular.isArray(g)?g.push(a.target.data):d[b]=a.target.data)}k=null},u=function(a){var b;return b=angular.element(angular.isDefined(l[a])?l[a]:l["default"]),b.css("pointer-events","none"),b},v={cancel:function(){return k?(k.cancel(),!0):!1},addDropTarget:function(a,b,c,d){if(-1===j.indexOf(a)){var e=a.data("ca-drap-scope");if(e)return e;a.data("ca-drop-scope",b),angular.isFunction(c)&&a.data("ca-drop-hover",c),angular.isFunction(d)&&a.data("ca-drop-complete",d),f.isMobile()||(a.on("mouseover",q),a.on("mouseout",r)),j.push(a)}},registerIndicator:function(a,b){if(angular.isDefined(l[b||"default"]))throw new Error("This indicator already registered");l=l||{},l[b||"default"]=a},register:function(b){var c=b.data("ca-drag");return c?c:(c=new e(b),c.setOptions(a),c.setType(b.attr("ca-drag-type")),l&&c.setIndicatorFactory(u),c.setDragOffset.apply(c,a.dragOffset),c.setDragPosition(a.dragPosition),c.on("start",n),c.on("complete",t),f.isMobile()&&c.on("dragging",p),b.data("ca-drag",c),i.push(c),c)}};return Object.defineProperty(v,"dragging",{get:function(){return h}}),Object.defineProperty(v,"active",{get:function(){return k}}),v}]}),angular.module("caDrag").service("DraggableElement",["$rootScope","$timeout","$document","$compile","DragUtil",function(a,b,c,d,e){var f=function(){return!0},g=function(){return!1},h=function(a,b,c){this.type=a,this.target=b,this.element=b.element,this.originalEvent=c};h.prototype={constructor:h,isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=f,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=f,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=f,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}};var i=c.find("body"),j=function(f){function g(a,b){var c=getComputedStyle(b);if(A)a.style.cssText=c.cssText;else for(var d in c)isNaN(parseInt(d,10))&&"function"!=typeof c[d]&&!/^(cssText|length|parentRule)$/.test(d)&&(a.style[d]=c[d])}function j(a,b){var c=a.querySelectorAll("*"),d=b.querySelectorAll("*");g(a,b,1),Array.prototype.forEach.call(c,function(a,b){g(a,d[b])}),a.style.margin=a.style.marginLeft=a.style.marginTop=a.style.marginBottom=a.style.marginRight=""}var k,l,m,n,o,p,q,r,s=!1,t=0,u=0,v=null,w=angular.noop,x="corner",y=!0,z={},A=""!==getComputedStyle(document.body).cssText,B=function(b){var c=w(v);if(c){var e=a.$new(!0);d(c)(e),e.$apply(function(){angular.forEach(k,function(a,b){e[b]=a})}),p=c,p.css("display","block"),b()}else{var f=0,g=0,h=0,l=0,n=m[0].cloneNode(!0);n.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),j(n,m[0]);var q=(new XMLSerializer).serializeToString(n),r='<svg xmlns="http://www.w3.org/2000/svg" width="'+((h||m[0].offsetWidth)+f)+'" height="'+((l||m[0].offsetHeight)+g)+'"><foreignObject width="100%" height="100%" x="'+f+'" y="'+g+'">'+q+"</foreignObject></svg>";p=angular.element(r),i.append(p),p.css({width:m.prop("offsetWidth")+"px",height:m.prop("offsetHeight")+"px"}),b()}p.css({cursor:"move","pointer-events":"none",position:"absolute",zIndex:"10000"}),p.addClass("ca-drag"),y&&(o=angular.element('<div class="feedback reject"></div>'),p.append(o)),i.append(p)},C=function(a){return a.getBoundingClientRect()},D=function(a){B(function(){r=a,q=C(m[0]),b(function(){E(a)})})},E=function(a){var b=0,c=0,d=e.getEventPosition(a),f=e.getEventPosition(r),g=C(p[0]);switch(x){case"center":b=d.x+t-g.width/2,c=d.y+u-g.height/2;break;case"clone":b=q.left-f.x+d.x+t,c=q.top-f.y+d.y+u;break;default:case"corner":b=d.x+t,c=d.y+u}p.css({left:b+"px",top:c+"px"})},F=function(){p&&p.remove()},G=function(a){m=a;var b=this,d=function(a){clearTimeout(l),s=!1,F(a),c.unbind("touchmove mousemove",e),c.unbind("touchend mouseup",d),b.emit("complete",new h("drag.complete",b,a))},e=function(a){a.preventDefault(),E(a),b.emit("dragging",new h("drag.move",b,a))};a.bind("mouseout",function(){s||clearTimeout(l)}),a.bind("touchstart mousedown",function(a){a.preventDefault(),l=setTimeout(function(){s=!0,D(a),b.emit("start",new h("drag.start",b,a)),c.bind("touchmove mousemove",e)},300),c.bind("touchend mouseup",d)}),this.cancel=function(){d()}};return G.prototype={on:function(a,b){n=n||{},n[a]=n[a]||[],n[a].push(b)},off:function(a,b){n=n||{},a in n!=!1&&n[a].splice(n[a].indexOf(b),1)},emit:function(a){if(n=n||{},a in n!=!1)for(var b=0;b<n[a].length;b++)n[a][b].apply(this,Array.prototype.slice.call(arguments,1))},setOptions:function(a){z=a},setDragOffset:function(a,b){t=a,u=b},setDragPosition:function(a){x=a||"corner"},showFeedback:function(a){y=a},setType:function(a){v=a},getType:function(){return v},setIndicatorFactory:function(a){w=a},event:function(a,b){return new h(a,this,b)},setFeedback:function(a){y&&o.attr("class","feedback "+a)},get dragging(){return s},set data(a){k=a},get data(){return k},get element(){return m}},new G(f)};return j}]),angular.module("caDrag").directive("caDragData",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){var e=a.register(c);d.caDragData&&(e.data=b.$eval(d.caDragData))}}}]).directive("caDragEnabled",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.register(c)}}}]).directive("caDropType",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){a.addDropTarget(c,b),c.data("ca-drop-type",d.caDropType)}}}]).directive("caDragIndicator",["DragManager",function(a){return{restrict:"A",compile:function(b,c){b[0].removeAttribute("ca-drag-indicator");var d=angular.element("<div>").append(b);a.registerIndicator(d.html(),c.caDragIndicator),b.remove()}}}]).directive("caDragBegin",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragBegin){var g=b(e.caDragBegin);angular.isFunction(g)&&f.on("start",function(a){g(c,{$event:a})})}}}}]).directive("caDragMove",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragMove){var g=b(e.caDragMove);angular.isFunction(g)&&f.on("dragging",function(a){g(c,{$event:a})})}}}}]).directive("caDragComplete",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragComplete){var g=b(e.caDragComplete);angular.isFunction(g)&&f.on("complete",function(a){g(c,{$event:a})})}}}}]).directive("caDropComplete",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropComplete&&(f=a(e.caDropComplete)),b.addDropTarget(d,c),d.data("ca-drop-complete",f)}}}]).directive("caDropHover",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropHover&&(f=a(e.caDropHover)),b.addDropTarget(d,c),d.data("ca-drop-hover",f)}}}]).directive("caDropAccept",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.addDropTarget(c,b)}}}]),angular.module("caDrag").service("DragUtil",function(){this.isMobile=function(){return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())},this.isHover=function(a,b){console.log(a,b)},this.getEventPosition=function(a){var b=0,c=0;if(a instanceof window.TouchEvent)a.touches&&a.touches.length&&(b=a.touches[0].pageX,c=a.touches[0].pageY);else{if(angular.isDefined(a.element)&&angular.isDefined(a.originalEvent))return this.getEventPosition(a.originalEvent);b=a.pageX,c=a.pageY}return{x:b,y:c}}});