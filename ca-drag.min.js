/**
* Drag & Drop AngularJS Module v1.1.1
* https://github.com/albulescu/caDrag
*
* Author Albulescu Cosmin <cosmin@albulescu.ro>
* Licensed under the MIT license.
*/

"use strict";angular.module("caDrag",[]).provider("DragManager",function(){var a={showFeedback:!0,dragOffset:[0,0],dragPosition:"corner",indicatorScale:1,indicatorStyle:[],indicatorFactory:null};this.setDragOffset=function(b,c){a.dragOffset=[b||0,c||0]},this.setDragPosition=function(b){a.dragPosition=b||"corner"},this.setIndicatorScale=function(b){a.indicatorScale=b||1},this.setIndicatorStyle=function(b){a.indicatorStyle=b||{}},this.setIndicatorFactory=function(b){a.indicatorFactory=b},this.$get=["$document","$timeout","$log","DraggableElement",function(b,c,d,e){var f=!1,g=[],h=[],i=null,j=!1,k=!1,l=function(){i=this,f=!0},m=function(a){if(f&&(k=o(a.currentTarget))){var b=k.data("ca-drop-hover")||angular.noop,c=i.event("drop.over",a.originalEvent);b(k.data("ca-drop-scope"),{$event:c}),k.addClass("ca-drag-over"),c.isDefaultPrevented()===!1&&i.setFeedback("accept")}},n=function(){k&&(k.removeClass("ca-drag-over"),k=null),i&&i.setFeedback("reject")},o=function(a){a=angular.element(a);for(var b=0;b<h.length;b++){var c=h[b];if(a[0]===c[0]){var d=i.getType(),e=c.data("ca-drop-type")||!1;return(d||e)&&d!==e?null:c}}return null},p=function(a){if(c(function(){f=!1}),!k)return void(i=null);var b=k.attr("ca-drop-model"),d=k.data("ca-drop-scope"),e=k.data("ca-drop-complete")||angular.noop;if(e(d,{$event:a}),!a.isDefaultPrevented()){var g=a.element.remove();k.append(g)}if(b){var h=d[b];angular.isDefined(h)&&(angular.isArray(h)?h.push(a.target.data):d[b]=a.target.data)}i=null},q=function(a){return angular.element(angular.isDefined(j[a])?j[a]:j["default"])},r={cancel:function(){return i?(i.cancel(),!0):!1},addDropTarget:function(a,b,c,d){var e=a.data("ca-drap-scope");return e?e:(a.data("ca-drop-scope",b),angular.isFunction(c)&&a.data("ca-drop-hover",c),angular.isFunction(d)&&a.data("ca-drop-complete",d),a.on("mouseover",m),a.on("mouseout",n),void h.push(a))},registerIndicator:function(a,b){if(angular.isDefined(j[b||"default"]))throw new Error("This indicator already registered");j=j||{},j[b||"default"]=a},register:function(b){var c=b.data("ca-drag");return c?c:(c=new e(b),c.setOptions(a),c.setType(b.attr("ca-drag-type")),j&&c.setIndicatorFactory(q),c.setDragOffset.apply(c,a.dragOffset),c.setDragPosition(a.dragPosition),c.on("start",l),c.on("complete",p),b.data("ca-drag",c),g.push(c),c)}};return Object.defineProperty(r,"dragging",{get:function(){return f}}),Object.defineProperty(r,"active",{get:function(){return i}}),r}]}),angular.module("caDrag").service("DraggableElement",["$rootScope","$timeout","$document","$compile",function(a,b,c,d){var e=function(){return!0},f=function(){return!1},g=function(a,b,c){this.type=a,this.target=b,this.element=b.element,this.originalEvent=c};g.prototype={constructor:g,isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=e,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=e,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=e,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}};var h=c.find("body"),i=function(e){function f(a,b){var c=getComputedStyle(b);if(z)a.style.cssText=c.cssText;else for(var d in c)isNaN(parseInt(d,10))&&"function"!=typeof c[d]&&!/^(cssText|length|parentRule)$/.test(d)&&(a.style[d]=c[d])}function i(a,b){var c=a.querySelectorAll("*"),d=b.querySelectorAll("*");f(a,b,1),Array.prototype.forEach.call(c,function(a,b){f(a,d[b])}),a.style.margin=a.style.marginLeft=a.style.marginTop=a.style.marginBottom=a.style.marginRight=""}var j,k,l,m,n,o,p,q,r=!1,s=0,t=0,u=null,v=angular.noop,w="corner",x=!0,y={},z=""!==getComputedStyle(document.body).cssText,A=function(b){var c=v(u);if(c){var e=a.$new(!0);d(c)(e),e.$apply(function(){angular.forEach(j,function(a,b){e[b]=a})}),o=c,o.css("display","block"),b()}else{var f=0,g=0,k=0,m=0,p=l[0].cloneNode(!0);p.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i(p,l[0]);var q=(new XMLSerializer).serializeToString(p),r='<svg xmlns="http://www.w3.org/2000/svg" width="'+((k||l[0].offsetWidth)+f)+'" height="'+((m||l[0].offsetHeight)+g)+'"><foreignObject width="100%" height="100%" x="'+f+'" y="'+g+'">'+q+"</foreignObject></svg>";o=angular.element(r),h.append(o),o.css({width:l.prop("offsetWidth")+"px",height:l.prop("offsetHeight")+"px"}),b()}o.css({cursor:"move","pointer-events":"none",position:"absolute",zIndex:"10000"}),o.addClass("ca-drag"),x&&(n=angular.element('<div class="feedback reject"></div>'),o.append(n)),h.append(o)},B=function(a){return a.getBoundingClientRect()},C=function(a){A(function(){q=a,p=B(l[0]),b(function(){D(a)})})},D=function(a){var b=0,c=0,d=B(o[0]);switch(w){case"center":b=a.pageX+s-d.width/2,c=a.pageY+t-d.height/2;break;case"clone":b=p.left-q.pageX+a.pageX+s,c=p.top-q.pageY+a.pageY+t;break;default:case"corner":b=a.pageX+s,c=a.pageY+t}o.css({left:b+"px",top:c+"px"})},E=function(){o&&o.remove()},F=function(a){l=a,a.attr("dragging","false");var b=this,d=function(a){clearTimeout(k),r=!1,E(a),c.unbind("touchmove mousemove",e),c.unbind("touchend mouseup",d),b.emit("complete",new g("drag.complete",b,a))},e=function(a){a.preventDefault(),D(a),b.emit("dragging",new g("drag.move",b,a))};a.bind("mouseout",function(){r||clearTimeout(k)}),a.bind("touchstart mousedown",function(a){a.preventDefault(),k=setTimeout(function(){r=!0,C(a),b.emit("start",new g("drag.start",b,a)),c.bind("touchmove mousemove",e)},300),c.bind("touchend mouseup",d)}),this.cancel=function(){d()}};return F.prototype={on:function(a,b){m=m||{},m[a]=m[a]||[],m[a].push(b)},off:function(a,b){m=m||{},a in m!=!1&&m[a].splice(m[a].indexOf(b),1)},emit:function(a){if(m=m||{},a in m!=!1)for(var b=0;b<m[a].length;b++)m[a][b].apply(this,Array.prototype.slice.call(arguments,1))},setOptions:function(a){y=a},setDragOffset:function(a,b){s=a,t=b},setDragPosition:function(a){w=a||"corner"},showFeedback:function(a){x=a},setType:function(a){u=a},getType:function(){return u},setIndicatorFactory:function(a){v=a},event:function(a,b){return new g(a,this,b)},setFeedback:function(a){x&&n.attr("class","feedback "+a)},get dragging(){return r},set data(a){j=a},get data(){return j},get element(){return l}},new F(e)};return i}]),angular.module("caDrag").directive("caDragData",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){var e=a.register(c);d.caDragData&&(e.data=b.$eval(d.caDragData))}}}]).directive("caDragEnabled",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.register(c)}}}]).directive("caDropType",["DragManager",function(a){return{restrict:"A",link:function(b,c,d){a.addDropTarget(c,b),c.data("ca-drop-type",d.caDropType)}}}]).directive("caDragIndicator",["DragManager",function(a){return{restrict:"A",compile:function(b,c){b[0].removeAttribute("ca-drag-indicator");var d=angular.element("<div>").append(b);a.registerIndicator(d.html(),c.caDragIndicator),b.remove()}}}]).directive("caDragBegin",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragBegin){var g=b(e.caDragBegin);angular.isFunction(g)&&f.on("start",function(a){g(c,{$event:a})})}}}}]).directive("caDragMove",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragMove){var g=b(e.caDragMove);angular.isFunction(g)&&f.on("dragging",function(a){g(c,{$event:a})})}}}}]).directive("caDragComplete",["DragManager","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=a.register(d);if(e.caDragComplete){var g=b(e.caDragComplete);angular.isFunction(g)&&f.on("complete",function(a){g(c,{$event:a})})}}}}]).directive("caDropComplete",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropComplete&&(f=a(e.caDropComplete)),b.addDropTarget(d,c),d.data("ca-drop-complete",f)}}}]).directive("caDropHover",["$parse","DragManager",function(a,b){return{restrict:"A",link:function(c,d,e){var f=angular.noop;e.caDropHover&&(f=a(e.caDropHover)),b.addDropTarget(d,c),d.data("ca-drop-hover",f)}}}]).directive("caDropAccept",["DragManager",function(a){return{restrict:"A",link:function(b,c){a.addDropTarget(c,b)}}}]);